<html>
<head>
<META HTTP-EQUIV="Content-type" CONTENT="text/html; charset=US-ASCII">
<META HTTP-EQUIV="Expires" CONTENT="Tue, 09 Aug 2050 22:16:01 GMT">
<title>
CSimpleSocket - C++ cross platform socket library
</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
<link href="foo.css" rel="stylesheet" type="text/css">
<LINK REV="made" href="mailto:mark@carrierlabs.com">
<META NAME="keywords" CONTENT="Sockets, TCP, UDP, Berkley Sockets, C++ socket library, carrierlabs, Mark Carrier">
<META NAME="description" CONTENT="C++ cross platform Berkley Socket class for build TCP and UDP sockets.">
<META NAME="author" CONTENT="Mark Carrier">
<META NAME="ROBOTS" CONTENT="ALL">
<!-- Metadata generated by http://vancouver-webpages.com/META/mk-metas.html -->
</head>
<body bgcolor="#ffffff"> 
<table width="100%">
  <tr>
    <td width="40%" align="left" valign="center">
      <a href="http://sockets.carrierlabs.com">
      CSocket project page
      </a>
    </td>
    <td>
    </td>
    <td width="40%" align="right" valign="center">
      <a href="http://sockets.carrierlabs.com">CSocket home page</a>
    </td>
  </tr>
</table>
<hr>
<!-- Generated by Doxygen 1.8.2 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">SimpleSocket Cookbook </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Here is a short cookbook to help you get started.</p>
<h1><a class="anchor" id="socket_overview"></a>
Simple Socket Class Overview</h1>
<p>Network communications via sockets can be abstracted into two categories of functionality; the <a class="el" href="classCActiveSocket.html">active socket </a> and the <a class="el" href="classCPassiveSocket.html">passive socket. </a> The <a class="el" href="classCActiveSocket.html">active socket </a> object initiates a connection with a known host, whereas the <a class="el" href="classCPassiveSocket.html">passive socket </a> object waits (or listens) for inbound requests for communication. The functionality of both objects is identical as far as sending and receiving data. This library makes distinction between the two objects because the operations for constructing and destructing the two are different.</p>
<p>This library is different from other socket libraries which define TCP sockets, UDP sockets, HTTP sockets, etc. The reason is the operations required for TCP, UDP, and RAW network communication is identical from a logical stand point. Thus a program could initially be written employing TCP streams, and then at some future point it could be discovered that UDP datagrams would satisify the solution. Changing between the two transport protocols would only require changing how the object is instantiated. The remaining code would in theory require minimal to no changes.</p>
<p>This library avoids abstractions like HTTP socket, or SMTP socket, soley because this type of object mixes the application and the transport layer. These types of abstractions can be created using this library as a base class.</p>
<p>The simple socket library is comprised of two class which can be used to represent all socket communications.</p>
<ul>
<li><a class="el" href="classCActiveSocket.html">Active Socket Class </a></li>
<li><a class="el" href="classCPassiveSocket.html">Passive Socket Class </a></li>
</ul>
<dl class="section user"><dt>Socket Class Overview</dt><dd></dd></dl>
<p>When operating on a socket object most methods will return <b>true</b> or <b>false</b> </p>
<h1><a class="anchor" id="simple_acitve_socket"></a>
Simple Active Socket</h1>
<p>As mentioned previously the active socket (<a class="el" href="classCActiveSocket.html" title="Provides a platform independent class to create an active socket.">CActiveSocket</a>) is used to initiate a connections with a server on some known port. So you want to connect to an existing server...</p>
<p>How do you do it?</p>
<p>There are many ways using the existing Berkley Socket API, but the goal of this class is to remove the many calls and man page lookups and replace them with clear, concise set of methods which allow a developer to focus on the logic of network programming.</p>
<p>The following code will connect to a DAYTIME server on port 13, query for the current time, and close the socket.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;string.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="ActiveSocket_8h.html">ActiveSocket.h</a>&quot;</span>       <span class="comment">// Include header for active socket object definition</span></div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="client_8cpp.html#a3c04138a5bfe5d72780bb7e82a18e627">main</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv)</div>
<div class="line">{</div>
<div class="line">    <a class="code" href="classCActiveSocket.html" title="Provides a platform independent class to create an active socket.">CActiveSocket</a> socket;       <span class="comment">// Instantiate active socket object (defaults to TCP).</span></div>
<div class="line">    <span class="keywordtype">char</span>          time[50];</div>
<div class="line"></div>
<div class="line">    memset(&amp;time, 0, 50);</div>
<div class="line"></div>
<div class="line">    <span class="comment">//--------------------------------------------------------------------------</span></div>
<div class="line">    <span class="comment">// Initialize our socket object </span></div>
<div class="line">    <span class="comment">//--------------------------------------------------------------------------</span></div>
<div class="line">    socket.<a class="code" href="classCSimpleSocket.html#ae50622a90672c5c697f2ec7a3a7eec06" title="Initialize instance of CSocket.">Initialize</a>();</div>
<div class="line"></div>
<div class="line">    <span class="comment">//--------------------------------------------------------------------------</span></div>
<div class="line">    <span class="comment">// Create a connection to the time server so that data can be sent</span></div>
<div class="line">    <span class="comment">// and received.</span></div>
<div class="line">    <span class="comment">//--------------------------------------------------------------------------</span></div>
<div class="line">    <span class="keywordflow">if</span> (socket.<a class="code" href="classCActiveSocket.html#a5701a40f547abb0f71b7c94e998c0008" title="Established a connection to the address specified by pAddr.">Open</a>((<span class="keyword">const</span> uint8 *)<span class="stringliteral">&quot;time-C.timefreq.bldrdoc.gov&quot;</span>, 13))</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">//----------------------------------------------------------------------</span></div>
<div class="line">        <span class="comment">// Send a requtest the server requesting the current time.</span></div>
<div class="line">        <span class="comment">//----------------------------------------------------------------------</span></div>
<div class="line">        <span class="keywordflow">if</span> (socket.<a class="code" href="classCSimpleSocket.html#acfd665d8d563b9d805c97a8ec9b66906" title="Attempts to send a block of data on an established connection.">Send</a>((<span class="keyword">const</span> uint8 *)<span class="stringliteral">&quot;\n&quot;</span>, 1))</div>
<div class="line">        {</div>
<div class="line">            <span class="comment">//------------------------------------------------------------------</span></div>
<div class="line">            <span class="comment">// Receive response from the server.</span></div>
<div class="line">            <span class="comment">//------------------------------------------------------------------</span></div>
<div class="line">            socket.<a class="code" href="classCSimpleSocket.html#a973c8856b081fa4d784d5a9751549b76" title="Attempts to receive a block of data on an established connection.">Receive</a>(49);</div>
<div class="line">            memcpy(&amp;time, socket.<a class="code" href="classCSimpleSocket.html#a706d748dcef01b3f68d6927e4fe4eb20" title="Get a pointer to internal receive buffer.">GetData</a>(), 49);</div>
<div class="line">            printf(<span class="stringliteral">&quot;%s\n&quot;</span>, time);</div>
<div class="line"></div>
<div class="line">            <span class="comment">//------------------------------------------------------------------</span></div>
<div class="line">            <span class="comment">// Close the connection.</span></div>
<div class="line">            <span class="comment">//------------------------------------------------------------------</span></div>
<div class="line">            socket.<a class="code" href="classCSimpleSocket.html#afbb30cef80ae0faec59403184cab3bb1" title="Close socket.">Close</a>();</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> 1;</div>
<div class="line">}</div>
</div><!-- fragment --><p>You can see that the amount of code required to an object for network communciation is very small and simple.</p>
<h1><a class="anchor" id="simple_passive_socket"></a>
Simple Passive Socket</h1>
<p>Now you want to build a server.</p>
<p>How do you do it?</p>
<p>For a practical test lets build an echo server. The server will listen on port 6789 an repsond back with what ever has been sent to the server.</p>
<div class="fragment"><div class="line"><span class="comment">//------------------------------------------------------------------------------</span></div>
<div class="line"><span class="comment">// ECHO SERVER CODE</span></div>
<div class="line"><span class="comment">//------------------------------------------------------------------------------</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="PassiveSocket_8h.html">PassiveSocket.h</a>&quot;</span>       <span class="comment">// Include header for active socket object definition</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#define MAX_PACKET 4096 </span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="client_8cpp.html#a3c04138a5bfe5d72780bb7e82a18e627">main</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv)</div>
<div class="line">{</div>
<div class="line">    <a class="code" href="classCPassiveSocket.html" title="Provides a platform independent class to create a passive socket.">CPassiveSocket</a> socket;</div>
<div class="line">    <a class="code" href="classCActiveSocket.html" title="Provides a platform independent class to create an active socket.">CActiveSocket</a> *pClient = NULL;</div>
<div class="line"></div>
<div class="line">    <span class="comment">//--------------------------------------------------------------------------</span></div>
<div class="line">    <span class="comment">// Initialize our socket object </span></div>
<div class="line">    <span class="comment">//--------------------------------------------------------------------------</span></div>
<div class="line">    socket.<a class="code" href="classCSimpleSocket.html#ae50622a90672c5c697f2ec7a3a7eec06" title="Initialize instance of CSocket.">Initialize</a>();</div>
<div class="line"></div>
<div class="line">    socket.<a class="code" href="classCPassiveSocket.html#ad6e2b48e34107deaff2a0fb5ca0d0667" title="Create a listening socket at local ip address &#39;x.x.x.x&#39; or &#39;localhost&#39; if pAddr is NULL on port nPort...">Listen</a>((<span class="keyword">const</span> uint8 *)<span class="stringliteral">&quot;127.0.0.1&quot;</span>, 6789);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">while</span> (<span class="keyword">true</span>)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">if</span> ((pClient = socket.<a class="code" href="classCPassiveSocket.html#a7749bf8e1d5a54de5ddc852584bf4a0d" title="Extracts the first connection request on the queue of pending connections and creates a newly connect...">Accept</a>()) != NULL)</div>
<div class="line">        {</div>
<div class="line">            <span class="comment">//------------------------------------------------------------------</span></div>
<div class="line">            <span class="comment">// Receive request from the client.</span></div>
<div class="line">            <span class="comment">//------------------------------------------------------------------</span></div>
<div class="line">            <span class="keywordflow">if</span> (pClient-&gt;<a class="code" href="classCSimpleSocket.html#a973c8856b081fa4d784d5a9751549b76" title="Attempts to receive a block of data on an established connection.">Receive</a>(<a class="code" href="client_8cpp.html#ac0622da4c10cb51a289339edcd13fce2">MAX_PACKET</a>))</div>
<div class="line">            {</div>
<div class="line">                <span class="comment">//--------------------------------------------------------------</span></div>
<div class="line">                <span class="comment">// Send response to client and close connection to the client.</span></div>
<div class="line">                <span class="comment">//--------------------------------------------------------------</span></div>
<div class="line">                pClient-&gt;<a class="code" href="classCSimpleSocket.html#acfd665d8d563b9d805c97a8ec9b66906" title="Attempts to send a block of data on an established connection.">Send</a>((<span class="keyword">const</span> uint8 *)pClient-&gt;<a class="code" href="classCSimpleSocket.html#a706d748dcef01b3f68d6927e4fe4eb20" title="Get a pointer to internal receive buffer.">GetData</a>(), pClient-&gt;<a class="code" href="classCSimpleSocket.html#ad0e9ba20a79d885263a37d302d965384" title="Returns the number of bytes received on the last call to CSocket::Receive().">GetBytesReceived</a>());</div>
<div class="line">                pClient-&gt;<a class="code" href="classCSimpleSocket.html#afbb30cef80ae0faec59403184cab3bb1" title="Close socket.">Close</a>();</div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line">            <span class="keyword">delete</span> pClient;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">//--------------------------------------------------------------------------</span></div>
<div class="line">    <span class="comment">// Receive request from the client.</span></div>
<div class="line">    <span class="comment">//--------------------------------------------------------------------------</span></div>
<div class="line">    socket.<a class="code" href="classCSimpleSocket.html#afbb30cef80ae0faec59403184cab3bb1" title="Close socket.">Close</a>();</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> 1;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">//------------------------------------------------------------------------------</span></div>
<div class="line"><span class="comment">// Echo Server Client</span></div>
<div class="line"><span class="comment">//------------------------------------------------------------------------------</span></div>
<div class="line"><span class="preprocessor">#include &lt;string.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="ActiveSocket_8h.html">ActiveSocket.h</a>&quot;</span>       <span class="comment">// Include header for active socket object definition</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#define TEST_PACKET &quot;TestPacket&quot;</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#define MAX_PACKET  1024</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="client_8cpp.html#a3c04138a5bfe5d72780bb7e82a18e627">main</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv)</div>
<div class="line">{</div>
<div class="line">    <a class="code" href="classCActiveSocket.html" title="Provides a platform independent class to create an active socket.">CActiveSocket</a> socket;       <span class="comment">// Instantiate active socket object (defaults to TCP).</span></div>
<div class="line">    <span class="keywordtype">char</span>          szData[<a class="code" href="client_8cpp.html#ac0622da4c10cb51a289339edcd13fce2">MAX_PACKET</a>];</div>
<div class="line"></div>
<div class="line">    memset(szData, 0, <a class="code" href="client_8cpp.html#ac0622da4c10cb51a289339edcd13fce2">MAX_PACKET</a>);</div>
<div class="line"></div>
<div class="line">    <span class="comment">//--------------------------------------------------------------------------</span></div>
<div class="line">    <span class="comment">// Initialize our socket object</span></div>
<div class="line">    <span class="comment">//--------------------------------------------------------------------------</span></div>
<div class="line">    socket.<a class="code" href="classCSimpleSocket.html#ae50622a90672c5c697f2ec7a3a7eec06" title="Initialize instance of CSocket.">Initialize</a>();</div>
<div class="line"></div>
<div class="line">    <span class="comment">//--------------------------------------------------------------------------</span></div>
<div class="line">    <span class="comment">// Create a connection to the time server so that data can be sent</span></div>
<div class="line">    <span class="comment">// and received.</span></div>
<div class="line">    <span class="comment">//--------------------------------------------------------------------------</span></div>
<div class="line">    <span class="keywordflow">if</span> (socket.<a class="code" href="classCActiveSocket.html#a5701a40f547abb0f71b7c94e998c0008" title="Established a connection to the address specified by pAddr.">Open</a>((<span class="keyword">const</span> uint8 *)<span class="stringliteral">&quot;localhost&quot;</span>, 6789))</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">//----------------------------------------------------------------------</span></div>
<div class="line">        <span class="comment">// Send a requtest the server requesting the current time.</span></div>
<div class="line">        <span class="comment">//----------------------------------------------------------------------</span></div>
<div class="line">        <span class="keywordflow">if</span> (socket.<a class="code" href="classCSimpleSocket.html#acfd665d8d563b9d805c97a8ec9b66906" title="Attempts to send a block of data on an established connection.">Send</a>((<span class="keyword">const</span> uint8 *)<a class="code" href="client_8cpp.html#a152da32a52335df9750401371545db85">TEST_PACKET</a>, strlen(<a class="code" href="client_8cpp.html#a152da32a52335df9750401371545db85">TEST_PACKET</a>)))</div>
<div class="line">        {</div>
<div class="line">            <span class="comment">//------------------------------------------------------------------</span></div>
<div class="line">            <span class="comment">// Receive response from the server.</span></div>
<div class="line">            <span class="comment">//------------------------------------------------------------------</span></div>
<div class="line">            socket.<a class="code" href="classCSimpleSocket.html#a973c8856b081fa4d784d5a9751549b76" title="Attempts to receive a block of data on an established connection.">Receive</a>(1024);</div>
<div class="line"></div>
<div class="line">            strncpy(szData, (<span class="keyword">const</span> <span class="keywordtype">char</span> *)socket.<a class="code" href="classCSimpleSocket.html#a706d748dcef01b3f68d6927e4fe4eb20" title="Get a pointer to internal receive buffer.">GetData</a>(), socket.<a class="code" href="classCSimpleSocket.html#ad0e9ba20a79d885263a37d302d965384" title="Returns the number of bytes received on the last call to CSocket::Receive().">GetBytesReceived</a>());</div>
<div class="line">            printf(<span class="stringliteral">&quot;%s\n&quot;</span>, szData);</div>
<div class="line"></div>
<div class="line">            <span class="comment">//------------------------------------------------------------------</span></div>
<div class="line">            <span class="comment">// Close the connection.</span></div>
<div class="line">            <span class="comment">//------------------------------------------------------------------</span></div>
<div class="line">            socket.<a class="code" href="classCSimpleSocket.html#afbb30cef80ae0faec59403184cab3bb1" title="Close socket.">Close</a>();</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> 1;</div>
<div class="line">}</div>
</div><!-- fragment --><p> You can see that the amount of code used to do this is very small, very easy to read, and very flexible. </p>
</div></div><!-- contents -->
<hr>
<table width="100%">
  <tr>
    <td width="10%" align="left" valign="center">
      <a href="http://www.carrierlabs.com"> 
      <img src="carrierlabs.jpg" width="120" height="62" border="0" alt="CarrierLabs Logo"/></a>
    </td>
    <td width="35%" align="left" valign="center">
      hosts this site.
    </td>
    <td>
<!-- Counter Code START -->
<table id="counter" onmouseover="fun();" onmouseout="nd();" cellspacing="0" cellpadding="0"><tr><td>
<center><table cellspacing="0" cellpadding="0"><tr><td><a href="http://www.visitorcounters.org/"><img style="border: 0;" src="http://www.visitorcounters.org/counter.php?type=1&id=MTUwNzI=" alt="free hit counter" title="free hit counter"/></a></td><td><a href="http://www.salvagedata.co.uk"><img style="border: 0;" src="http://www.visitorcounters.org/counter.php?type=2&id=MTUwNzI=" alt="data recovery" title="data recovery"/></a></td></tr></table></center></td></tr>
<tr><td>
<center><a href="http://www.salvagedata.com" target="_blank"><span style="font-size:11px;">data recovery services</span></a></center></td></tr>
</table>
<script type="text/javascript" src="http://www.visitorcounters.org/getCode.php?id=MTUwNzI="></script>
<!-- Counter Code END -->
    </td>
<td>
<form action="https://www.paypal.com/cgi-bin/webscr" method="post">
<input type="hidden" name="cmd" value="_s-xclick">
<input type="hidden" name="hosted_button_id" value="1136058">
<input type="image" src="https://www.paypal.com/en_US/i/btn/btn_donateCC_LG.gif" border="0" name="submit" alt="">
<img alt="" border="0" src="https://www.paypal.com/en_US/i/scr/pixel.gif" width="1" height="1">
</form>
</td>
    <td align="right" valign="center">
      Send comments to:<br>
      <a href="mailto:mark@carrierlabs.com">CarrierLabs Developers</a>
    </td>
  </tr>
</table>
</body> 
</html>
